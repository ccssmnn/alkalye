# Progress Log

## 2026-01-10: Slideshow Text Wrapping

**Feature:** slideshow-scaling (3 user stories)

**Changes:**
- Fixed text wrapping: content now wraps at container width instead of scaling to tiny size
- Added `max-w-full` and `overflow-wrap: break-word` to slide blocks for proper text wrapping
- Changed measurement to use width constraint so text wraps before scaling kicks in
- Scaling now only reduces size when wrapped content height exceeds viewport
- Fixed lint errors: refactored `useThemeStyles` hook to use "adjust state during render" pattern instead of synchronous setState in effects

**Files modified:**
- src/components/slideshow.tsx
- src/components/preview.tsx

**Notes for next dev:**
- Theming infrastructure is already in place (useDocumentTheme, theme-renderer, CSS injection)
- The slideshow theming stories should be next priority
- Pre-existing test failures in documents.test.ts and spaces.test.ts (Jazz sync issues) are unrelated

---

## 2026-01-10: Slideshow Semantic HTML

**Feature:** slideshow-semantic-html (3 user stories)

**Changes:**
- Wrapped slideshow content in `<article>` element with `data-theme` attribute
- Changed headings from `<div>` to proper `<h1>`-`<h6>` elements based on depth
- Changed paragraph text from `<div>` to `<p>` elements

**Files modified:**
- src/components/slideshow.tsx

**Notes for next dev:**
- This enables CSS selectors like `[data-theme="ThemeName"] h1` to work
- The slideshow theming stories should now be unblocked
- Pre-existing test failures in documents.test.ts and spaces.test.ts (Jazz sync issues) are unrelated

---

## 2026-01-10: Slideshow Theme CSS Support

**Feature:** slideshow-theming (5 user stories)

**Changes:**
- Removed hardcoded Tailwind color classes from slideshow elements to allow theme CSS to apply
- Links: removed `text-brand`, now use `var(--preset-link, var(--preset-accent, currentColor))`
- Inline code: removed `bg-muted`, now use `var(--preset-code-background, rgba(127,127,127,0.15))`
- Blockquotes: removed `border-brand`, now use `var(--preset-accent, currentColor)`
- Code blocks fallback: removed `bg-muted`/`text-foreground`, now use CSS vars
- Image placeholder: removed `bg-muted`/`text-muted-foreground`, now use CSS vars

**Files modified:**
- src/components/slideshow.tsx

**Notes for next dev:**
- Theme CSS now applies via `[data-theme] h1`, `[data-theme] p`, etc selectors
- Preset colors (background, foreground, accent, etc) are injected as CSS variables
- Next priority: slideshow-theming preset colors stories (lines 128-164 in PRD)
- Pre-existing test failures in documents.test.ts/spaces.test.ts are unrelated (Jazz sync issues)

---

## 2026-01-10: Slideshow Preset Colors (Verification)

**Feature:** slideshow-theming preset colors (3 user stories)

**Status:** Already implemented - marked PRD as passing

**Implementation locations:**
- `src/components/slideshow.tsx:167-174` - applies `var(--preset-background)` and `var(--preset-foreground)` to main container
- `src/components/slideshow.tsx:561` - links use `var(--preset-link, var(--preset-accent, currentColor))`
- `src/components/slideshow.tsx:689` - blockquotes use `var(--preset-accent, currentColor)` for border
- `src/lib/theme-renderer.ts:364-400` - `buildPresetVariables()` generates `:root { --preset-* }` CSS variables
- `src/lib/document-theme.ts:276-286` - `useDocumentTheme` auto-selects preset by appearance (light/dark)

**How it works:**
1. User creates theme with light/dark presets in presets.json
2. `useDocumentTheme` resolves theme + auto-selects preset based on system appearance
3. `buildPresetVariables()` injects preset colors as CSS variables: `--preset-background`, `--preset-foreground`, `--preset-accent`, etc.
4. Slideshow applies these via inline styles and CSS var references

**Notes for next dev:**
- Next priority: slideshow-presets stories (auto-selecting light/dark presets)
- Pre-existing test failures in documents.test.ts/spaces.test.ts are unrelated (Jazz sync issues)

---

## 2026-01-10: Slideshow Preset Auto-Selection

**Feature:** slideshow-presets (3 user stories)

**Changes:**
- Fixed `useDocumentTheme` to fall through to default theme when frontmatter has appearance-only value (`theme: light` or `theme: dark`)
- Previously, `theme: dark` would skip default theme lookup and return null
- Now, appearance values are detected and the hook continues to check for default theme in settings
- Warning message no longer fires for appearance-only values when no default is set

**Files modified:**
- src/lib/document-theme.ts

**How it works:**
1. User writes `theme: dark` in frontmatter (appearance override)
2. `parsePresentationTheme()` extracts this as appearance value
3. `useDocumentTheme()` detects "dark" is an appearance-only value (not a theme name)
4. Hook falls through to load default slideshow theme from settings
5. The dark appearance passed to hook causes dark preset to be selected

**Notes for next dev:**
- Next priority: preview-css-loading or preview-theming stories
- Pre-existing test failures in documents.test.ts/spaces.test.ts are unrelated (Jazz sync issues)

---

## 2026-01-10: Preview Theming Support

**Feature:** preview-css-loading (3 stories) + preview-theming (7 stories) = 10 user stories

**Changes:**
- Fixed preview to pass system appearance to `useDocumentTheme` for preset auto-selection
- Previously preview called `useDocumentTheme(content, "preview")` without appearance
- Now calls `useDocumentTheme(content, "preview", resolvedTheme)` matching slideshow behavior

**Files modified:**
- src/components/preview.tsx:39

**How it works:**
1. Preview already had `useResolvedTheme()` to get system light/dark mode
2. Now passes this to `useDocumentTheme` as third argument
3. Theme presets are auto-selected by appearance (light/dark) just like slideshow
4. CSS, fonts, and preset variables are injected via `<style>` tag

**Implementation already in place (verified):**
- `preview.tsx:87-88` - `useThemeStyles(documentTheme)` loads CSS async
- `preview.tsx:139-149` - combines fontFaceRules + presetVariables + css
- `preview.tsx:189` - injects via `<style>{injectedStyles}</style>`
- `preview.tsx:211,219` - `data-theme` attribute on containers
- `preview.tsx:152-174` - template rendering with `tryRenderTemplateWithContent`

**Notes for next dev:**
- Next priority: theme-presets, theme-upload, or theme-defaults stories
- Pre-existing test failures in documents.test.ts/spaces.test.ts are unrelated (Jazz sync issues)
